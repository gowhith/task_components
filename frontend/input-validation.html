<!-- input-component.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Input Component with Validation</title>
  <script type="module">
    import { LitElement, html, css } from 'https://unpkg.com/lit@2.5.0/index.js?module';

    class InputComponent extends LitElement {
      static properties = {
        maxLength: { type: Number },
        value: { type: String, state: true },
        errorMessage: { type: String, state: true }
      };

      constructor() {
        super();
        this.maxLength = 200;
        this.value = '';
        this.errorMessage = '';
      }

      static styles = css`
        textarea {
          width: 300px;
          height: 100px;
          font-size: 14px;
        }
        .count {
          font-size: 12px;
          color: #555;
        }
        .error {
          color: red;
          font-size: 12px;
          margin-top: 4px;
        }
        button {
          margin-top: 10px;
          padding: 5px 10px;
        }
      `;

      render() {
        return html`
          <div>
            <textarea
              .value=${this.value}
              @input=${this._handleInput}
              maxlength=${this.maxLength + 50}  
            ></textarea>
            <div class="count">${this.value.length}/${this.maxLength} characters</div>
            ${this.value.length > this.maxLength ? html`<div class="error">Character limit exceeded!</div>` : ''}
            ${this.errorMessage ? html`<div class="error">${this.errorMessage}</div>` : ''}
            <button @click=${this._submit}>Submit</button>
          </div>
        `;
      }

      _handleInput(e) {
        this.value = e.target.value;
        this.errorMessage = '';
        this.dispatchEvent(new CustomEvent('input-changed', { detail: { value: this.value } }));
      }

      _submit() {
        if (this.value.trim() === '') {
          this.errorMessage = 'Input cannot be empty';
          this.dispatchEvent(new CustomEvent('submit-failed', { detail: { reason: 'empty' } }));
        } else if (this.value.length > this.maxLength) {
          this.errorMessage = 'Input exceeds maximum length';
          this.dispatchEvent(new CustomEvent('submit-failed', { detail: { reason: 'length' } }));
        } else {
          this.errorMessage = '';
          this.dispatchEvent(new CustomEvent('form-submitted', { detail: { value: this.value } }));
        }
      }
    }

    customElements.define('input-component', InputComponent);
  </script>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
  </style>
</head>
<body>
  <h3>Input Component Demo</h3>
  <input-component maxLength="200"></input-component>

  <script>
    const inputComp = document.querySelector('input-component');

    inputComp.addEventListener('form-submitted', (e) => {
      alert('Form submitted with value: ' + e.detail.value);
    });

    inputComp.addEventListener('submit-failed', (e) => {
      console.warn('Submission failed:', e.detail.reason);
    });
  </script>
</body>
</html>
